services:
  - type: web
    name: goleador-sms-api
    runtime: python
    pythonVersion: 3.10

    # Comando para iniciar la aplicación
    startCommand: gunicorn -w 4 -b 0.0.0.0:$PORT app:app

    # Repositorio GitHub
    repo: https://github.com/tu-usuario/GoleadorSmsMarketing

    # Branch a desplegar
    branch: main

    # Variables de entorno
    envVars:
      - key: FLASK_ENV
        value: production
      - key: DEBUG
        value: "false"
      - key: MAX_CONTENT_LENGTH
        value: "16777216"
      - key: ACCOUNT
        scope: build
        sync: false
      - key: PASSWORD
        scope: build
        sync: false

    # Archivos estáticos
    staticFilesDir: static

    # Métodos de deploy
    deploy:
      - type: build
        command: |
          pip install --no-cache-dir -r requirements.txt
          python -m pytest tests/ --tb=short 2>/dev/null || true

      - type: deploy
        command: |
          python -c "from database import Database; db = Database(); db.initialize()" || true

    # Configuración de healthcheck
    healthCheckPath: /login

    # Autoscaling (opcional)
    scaling:
      minInstances: 1
      maxInstances: 5
      targetCPUPercent: 70
      targetMemoryPercent: 80

    # Exposición de puertos
    exposedPort: 5000

    # Discos persistentes para base de datos
    disks:
      - name: database
        mountPath: /data
        sizeGB: 1

# Base de datos (PostgreSQL - opcional para producción)
# databases:
#   - name: goleador-db
#     database: goleador_sms
#     user: goleador_user
#     plan: starter
#     version: "14"
